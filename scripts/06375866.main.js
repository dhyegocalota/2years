var APP={};APP.initialize=function(){APP.tests.initialize(),APP.sounds.initialize(),APP.outdoor.initialize(),APP.declaration.initialize()},APP.tests={cssRules:["csstransitions","cssanimations","csstransforms","csstransforms3d","backgroundsize","opacity"],initialize:function(){var a=!0;$.each(this.cssRules,function(b,c){a=Modernizr[c]}),a||$("html").addClass("browser-too-old")}},APP.sounds={$:{player:$("#jplayer"),playerContainer:$("#jplayer-container")},initialize:function(){this.doList()},doList:function(){this.playlist=new jPlayerPlaylist({jPlayer:this.$.player.selector,cssSelectorAncestor:this.$.playerContainer.selector},[{title:"The A team",mp3:"musics/the-a-team.mp3"},{title:"Give me love",mp3:"musics/give-me-love.mp3"}],{playlistOptions:{autoPlay:!0},swfPath:"http://jplayer.org/latest/js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0})}},APP.outdoor={PHOTOS:24,SLIDER_INTERVAL:3e3,$:{presentation:$(".presentation-container"),photo:$(".photo"),declarationSection:$("#declaration-section"),sliders:{}},initialize:function(){this.attachEvents(),this.create(),this.insert(),this.doSlider()},attachEvents:function(){$("#presentation-section .btn-section-down").on("click",this.onBtnSectionDownClick.bind(this))},onBtnSectionDownClick:function(a){a.preventDefault(),$("html, body").animate({scrollTop:this.$.declarationSection.offset().top},1e3)},create:function(){var a=$("<span/>"),b=$("<div/>");b.addClass("presentation-outdoor"),a.addClass("photo-shadow");for(var c=1;c<this.PHOTOS+1;c++){var d=$("<figure/>");d.addClass("photo").attr("data-key",c).attr("style","background-image:url('images/personal/"+c+".jpg')").append(a.clone()),b.append(d)}this.$.photos=b},insert:function(){var a=this;this.$.presentation.each(function(){$(this).append($(a.$.photos).clone())})},doSlider:function(){var a=this;this.$.slidersCount=this.$.presentation.length,this.$.presentation.each(function(){a.changeUniqueRandomSlider(this)}),setInterval(function(){for(var b,c=a.randomNumber(a.$.slidersCount);c===a.$.lastSliderKeyChanged;)c=a.randomNumber(a.$.slidersCount);a.$.lastSliderKeyChanged=c,b=a.$.presentation.eq(c-1),a.changeUniqueRandomSlider(b)},this.SLIDER_INTERVAL)},changeUniqueRandomSlider:function(a){var b,c,d=$(a),e=d.index(),f=d.find(".presentation-outdoor"),g=this.randomNumber(this.PHOTOS);if(this.$.slidersCount)for(;-1!==this.indexOfKey(g);)g=this.randomNumber(this.PHOTOS);"undefined"!=typeof this.$.sliders[e]&&(b=f.children(".active"),b.removeClass("active")),this.$.sliders[e]=g,c=f.children(":eq("+(g-1)+")"),c.addClass("active")},randomNumber:function(a){return"undefined"==typeof a?0:Math.floor(Math.random()*parseInt(a))+1},indexOfKey:function(a){return this.getImagesKeys().indexOf(a)},getImagesKeys:function(){return $.map(this.$.sliders,function(a){return a})}},APP.declaration={DURATION_PX:200,$:{outdoor:$("#declaration-outdoor"),section:$("#declaration-section"),btnControl:$("#declaration-text-controls .control")},initialize:function(){this.attachEvents()},attachEvents:function(){$(window).on("scroll",this.blurryImgOnWindowScroll.bind(this)),$(window).on("scroll",this.playTextOnWindowScroll.bind(this)),this.$.btnControl.on("click",this.onBtnControlClick.bind(this))},blurryImgOnWindowScroll:function(){var a,b=this.$.outdoor.offset().top,c=this.$.outdoor.find(".blurred-img"),d=$(window).scrollTop();return d<b-this.DURATION_PX?(c.css("opacity",0),!1):(a=(d-b)/this.DURATION_PX,0>a?a=0:a>1&&(a=1),void c.css("opacity",a))},playTextOnWindowScroll:function(){var a=this.$.section.offset().top-100,b=$(window).scrollTop();b>=a&&!this.textIsPlaying()?this.playText():a>b&&this.textIsPlaying()&&this.pauseText()},onBtnControlClick:function(a){a.preventDefault(),this.textIsPlaying()?this.pauseText():this.playText()},textIsPlaying:function(){return this.$.section.hasClass("playing")},pauseText:function(){this.$.section.removeClass("playing").addClass("paused")},playText:function(){1!==APP.sounds.playlist.current&&APP.sounds.playlist.play(1),this.$.section.removeClass("paused").addClass("playing")}},$(function(){APP.initialize()});